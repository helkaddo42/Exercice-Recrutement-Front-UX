import React,{useState } from 'react';
import axios from 'axios';
import main from './mainForm.module.css';
import RigthContainers from './BlockRight/blockRight';
import LeftContainers from './BlockLeft/blockLeft';

function MainForm() {
    const[displayCity, setDisplayCity] = useState(false);
    const[depart, setDepart] = useState('');
    const[arriver, setArriver] = useState('');
    const[idInput, setIdInput] = useState('');
    const[vile, setVille] = useState([]);

    const PopCity = (e) =>{
        setIdInput(e.target.id);
        if(vile.length === 0){
            axios.get(`https://api.comparatrip.eu/cities/popular/5`)
            .then((response)=>{
                const valueResponse = response.data
                const cityName = valueResponse.map(city =>{ return city.unique_name})
                setVille(cityName) 
            }).catch((err)=>{ console.log(err) })  
        }
    }

    const suggestion = (e) =>{
        const id = e.target.id;
        id === 'depart' ?  setDepart(e.target.value) : setArriver(e.target.value)
        axios.get(`https://api.comparatrip.eu/cities/autocomplete/?q=${e.target.value}`)
        .then((response)=>{
            const valueResponse = response.data;
            const cityChoise = valueResponse.map(city =>{ return city.unique_name})
            setVille(cityChoise) 
            setIdInput(id)
        }).catch((err)=>{ console.log(err) })
    }

    const popularTo = (e) => {
        if(arriver !== ''){
            axios.get(`https://api.comparatrip.eu/cities/popular/to/${arriver}/5`)
            .then(response =>{
                const from = response.data;
                const city = from.map(value =>{ return value.unique_name})
                setVille(city)
            }).catch((err)=>{ console.log(err) })
        }
    }

    const popularFrom = (e) => {
        if(depart !== ''){
            axios.get(`https://api.comparatrip.eu/cities/popular/from/${depart}/5`)
            .then(response =>{
                const from = response.data;
                const city = from.map(value =>{ return value.unique_name})
                setVille(city)
            }).catch((err)=>{ console.log(err) })
        }
    }
 
    let blockCityRight = (
        <div className={main.blockUl}>
            <ul className={main.Ul}>  
                {vile.map(city => ( 
                <li className={main.Li} key={city} onClick={() => {idInput === 'depart' ? setDepart(city) : setArriver(city)}}>
                    {city}
                </li>) )} 
            </ul>  
        </div>
    )

    return (
        <div className={main.mainForm}>
            <LeftContainers
                popularTo={popularTo}
                PopCity={PopCity}
                suggestion={suggestion}
                popularFrom={popularFrom}
                display={()=>setDisplayCity(true)}
                depart={depart}
                arriver={arriver}/>
            {displayCity === false ? <RigthContainers/> : <>{blockCityRight}</>}     
        </div>
    )
}

export default MainForm
